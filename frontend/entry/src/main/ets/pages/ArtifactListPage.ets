
import router from '@ohos.router';
import http from '@ohos.net.http';
import promptAction from '@ohos.promptAction';
import ApiConstants from '../common/constants/ApiConstants';
import { CommonTabBar } from '../common/components/CommonTabBar';

// å®šä¹‰HTTPé”™è¯¯ç±»å‹
interface HttpError {
  code?: number;
  message?: string;
}

// å®šä¹‰æ–‡ç‰©æ¥å£
interface Artifact {
  id: number;            // ä½¿ç”¨idä½œä¸ºä¸»é”®ï¼Œä¸åç«¯ä¿æŒä¸€è‡´
  name: string;
  era: string;
  type: string;
  museum: string;
  description: string;
  imageUrl: string;
  likes: number;
  dynasty?: string;      // æ·»åŠ åç«¯è¿”å›çš„å…¶ä»–å­—æ®µ
  category?: string;     // æ·»åŠ åç«¯è¿”å›çš„å…¶ä»–å­—æ®µ
}

// APIå“åº”æ¥å£
interface ApiResponse {
  success: boolean;
  message?: string;
  data?: Artifact[];
}

// å®šä¹‰HTTPè¯·æ±‚å›è°ƒå‡½æ•°çš„ç±»
class HttpCallbackClass {
  onResponse(err: HttpError | null, data: http.HttpResponse): void {
  }
}

@Entry
@Component
struct ArtifactListPage {
  @State artifacts: Array<Artifact> = [];
  @State filteredArtifacts: Array<Artifact> = []; // æ·»åŠ è¿‡æ»¤åçš„æ–‡ç‰©æ•°ç»„
  @State isLoading: boolean = true;
  @State currentTab: number = 0;
  @State errorMsg: string = '';
  @State searchKeyword: string = ''; // æ·»åŠ æœç´¢å…³é”®è¯çŠ¶æ€

  // æ±‰å­—æ‹¼éŸ³æ˜ å°„å­—å…¸ - å¸¸ç”¨æ±‰å­—çš„æ‹¼éŸ³é¦–å­—æ¯
  private pinyinMap: Record<string, string> = {
    'ç“·': 'ci', 'å™¨': 'qi', 'ä¹¦': 'shu', 'ç”»': 'hua', 'é’': 'qing', 'é“œ': 'tong',
    'ç‰': 'yu', 'é›•': 'diao', 'å¡‘': 'su', 'æ–‡': 'wen', 'ç‰©': 'wu', 'é¦†': 'guan',
    'å”': 'tang', 'å®‹': 'song', 'å…ƒ': 'yuan', 'æ˜': 'ming', 'æ¸…': 'qing', 'ä»£': 'dai',
    'å¤': 'gu', 'ä»Š': 'jin', 'ä¸­': 'zhong', 'å›½': 'guo', 'åš': 'bo', 'ç': 'zhen',
    'è´µ': 'gui', 'å†': 'li', 'å²': 'shi', 'é™¶': 'tao', 'ç“¯': 'ou', 'å½©': 'cai',
    'é‡‘': 'jin', 'é“¶': 'yin', 'é“': 'tie', 'çŸ³': 'shi', 'æœ¨': 'mu', 'ç«¹': 'zhu',
    'ä¸': 'si', 'ç»¸': 'chou', 'ç»£': 'xiu', 'å·¥': 'gong', 'è‰º': 'yi', 'å“': 'pin'
  };

  private httpRequest = http.createHttp();
  // æ–‡ç‰©ç±»å‹è¿‡æ»¤é€‰é¡¹
  private artifactTypes: string[] = ['å…¨éƒ¨', 'ç“·å™¨', 'ä¹¦ç”»', 'é’é“œ', 'ç‰å™¨', 'é›•å¡‘', 'å…¶ä»–'];

  aboutToAppear() {
    this.loadArtifacts();
  }

  // æ·»åŠ é¡µé¢æ˜¾ç¤ºæ—¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œç¡®ä¿ä»è¯¦æƒ…é¡µè¿”å›æ—¶æ›´æ–°ç‚¹èµæ•°
  onPageShow() {
    console.info('æ–‡ç‰©åˆ—è¡¨é¡µé¢é‡æ–°æ˜¾ç¤ºï¼Œåˆ·æ–°æ•°æ®');
    // ä¿æŒå½“å‰çš„é€‰é¡¹å¡ï¼Œåˆ·æ–°å¯¹åº”ç±»å‹çš„æ–‡ç‰©æ•°æ®
    this.loadArtifacts(this.artifactTypes[this.currentTab]);
  }

  aboutToDisappear() {
    if (this.httpRequest) {
      this.httpRequest.destroy();
    }
  }

  // å°†ä¸­æ–‡è½¬æ¢ä¸ºæ‹¼éŸ³
  toPinyin(text: string): string {
    let result = '';
    for(let i = 0; i < text.length; i++) {
      const char = text[i];
      // å¦‚æœæ˜¯ä¸­æ–‡å­—ç¬¦ï¼Œå°è¯•è½¬æ¢ä¸ºæ‹¼éŸ³
      if(/[\u4e00-\u9fa5]/.test(char)) {
        result += this.pinyinMap[char] || char;
      } else {
        // éä¸­æ–‡å­—ç¬¦ä¿æŒä¸å˜
        result += char;
      }
    }
    return result.toLowerCase();
  }

  // æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‹¼éŸ³
  matchesPinyin(text: string, keyword: string): boolean {
    // å°†æ–‡æœ¬è½¬ä¸ºæ‹¼éŸ³
    const textPinyin = this.toPinyin(text);
    // æ£€æŸ¥æ‹¼éŸ³æ˜¯å¦åŒ…å«å…³é”®è¯
    return textPinyin.includes(keyword.toLowerCase());
  }

  loadArtifacts(type: string = '') {
    this.isLoading = true;
    this.errorMsg = '';

    // æ„å»ºAPI URL
    let url = ApiConstants.getFullUrl(ApiConstants.API_ARTIFACTS);
    if (type && type !== 'å…¨éƒ¨') {
      url += `/type/${encodeURIComponent(type)}`;
    }

    console.info(`å¼€å§‹è¯·æ±‚æ–‡ç‰©æ•°æ®ï¼ŒURL: ${url}`);
    promptAction.showToast({
      message: 'æ­£åœ¨åŠ è½½æ–‡ç‰©æ•°æ®...',
      duration: 1500
    });

    try {
      this.httpRequest.request(
        url,
        {
          method: http.RequestMethod.GET,
          header: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          connectTimeout: 30000, // 30ç§’è¿æ¥è¶…æ—¶
          readTimeout: 30000     // 30ç§’è¯»å–è¶…æ—¶
        },
        (err: HttpError | null, data: http.HttpResponse) => {
          if (!err && data.responseCode === 200) {
            try {
              console.info(`æˆåŠŸæ¥æ”¶åˆ°å“åº”ï¼ŒçŠ¶æ€ç : ${data.responseCode}`);
              console.info(`å“åº”æ•°æ®: ${data.result}`);

              const resultStr = data.result ? data.result.toString() : '[]';
              console.info(`è½¬æ¢ä¸ºå­—ç¬¦ä¸²: ${resultStr.substring(0, 100)}...`); // åªè®°å½•å‰100ä¸ªå­—ç¬¦é¿å…æ—¥å¿—è¿‡é•¿

              const result: Array<Artifact> = JSON.parse(resultStr);
              if (Array.isArray(result)) {
                this.artifacts = result;
                console.info(`æˆåŠŸè§£æä¸ºæ•°ç»„ï¼ŒåŒ…å«${this.artifacts.length}ä¸ªé¡¹ç›®`);

                // è®°å½•ç¬¬ä¸€ä¸ªé¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•
                if (this.artifacts.length > 0) {
                  console.info(`ç¬¬ä¸€ä¸ªæ–‡ç‰©ç¤ºä¾‹: ${JSON.stringify(this.artifacts[0])}`);
                }

                this.updateFilteredArtifacts(); // æ›´æ–°è¿‡æ»¤åçš„æ–‡ç‰©åˆ—è¡¨

                if (this.artifacts.length === 0) {
                  console.warn('è·å–åˆ°ç©ºæ•°ç»„ï¼Œæ²¡æœ‰æ–‡ç‰©æ•°æ®');
                  this.errorMsg = 'æš‚æ— æ•°æ®';
                  promptAction.showToast({
                    message: 'æš‚æ— æ–‡ç‰©æ•°æ®',
                    duration: 2000
                  });
                } else {
                  promptAction.showToast({
                    message: `å·²åŠ è½½${this.artifacts.length}ä¸ªæ–‡ç‰©`,
                    duration: 2000
                  });
                }
              } else {
                console.error(`APIè¿”å›çš„æ•°æ®ä¸æ˜¯æ•°ç»„: ${typeof result}`);
                this.errorMsg = 'æ•°æ®æ ¼å¼é”™è¯¯ï¼šè¿”å›çš„ä¸æ˜¯æ•°ç»„';
                this.artifacts = [];
                this.filteredArtifacts = [];
                promptAction.showToast({
                  message: 'æ•°æ®æ ¼å¼é”™è¯¯',
                  duration: 2000
                });
              }
            } catch (e) {
              console.error(`è§£æå“åº”å¤±è´¥: ${e.toString()}`);
              console.error(`åŸå§‹å“åº”æ•°æ®: ${data.result?.toString().substring(0, 200) || 'ç©º'}`);
              this.errorMsg = `è§£ææ•°æ®å¤±è´¥: ${e.toString()}`;
              this.artifacts = [];
              this.filteredArtifacts = [];
              promptAction.showToast({
                message: 'è§£ææ•°æ®å¤±è´¥',
                duration: 2000
              });
            }
          } else {
            const errMsg = err ? err.message : 'æœªçŸ¥é”™è¯¯';
            const respCode = data ? data.responseCode.toString() : 'N/A';
            console.error(`è¯·æ±‚å¤±è´¥: ${errMsg}, å“åº”ç : ${respCode}`);
            this.errorMsg = `ç½‘ç»œè¯·æ±‚å¤±è´¥: ${errMsg}, å“åº”ç : ${respCode}`;
            this.artifacts = [];
            this.filteredArtifacts = [];
            promptAction.showToast({
              message: `ç½‘ç»œé”™è¯¯: ${errMsg}`,
              duration: 3000
            });
          }
          this.isLoading = false;
        }
      );
    } catch (e) {
      console.error(`å‘èµ·è¯·æ±‚å¼‚å¸¸: ${e.toString()}`);
      this.errorMsg = `å‘èµ·è¯·æ±‚å¼‚å¸¸: ${e.toString()}`;
      this.isLoading = false;
      this.artifacts = [];
      this.filteredArtifacts = [];
      promptAction.showToast({
        message: 'ç½‘ç»œè¿æ¥å¼‚å¸¸',
        duration: 3000
      });
    }
  }

  // æ·»åŠ å…³é”®è¯æœç´¢æ–¹æ³•
  updateFilteredArtifacts() {
    if (!this.searchKeyword || this.searchKeyword.trim() === '') {
      // å¦‚æœæ²¡æœ‰æœç´¢å…³é”®è¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ–‡ç‰©
      this.filteredArtifacts = [...this.artifacts];
      return;
    }

    // ä½¿ç”¨å…³é”®è¯å¯¹æ–‡ç‰©è¿›è¡Œè¿‡æ»¤
    const keyword = this.searchKeyword.toLowerCase().trim();
    console.info(`æ‰§è¡Œæœç´¢ï¼Œå…³é”®è¯: "${keyword}"`);

    this.filteredArtifacts = this.artifacts.filter(item => {
      // ç›´æ¥æ–‡æœ¬åŒ¹é…
      const nameMatch = item.name.toLowerCase().includes(keyword);
      const descMatch = item.description?.toLowerCase().includes(keyword) || false;
      const typeMatch = item.type.toLowerCase().includes(keyword);
      const eraMatch = item.era.toLowerCase().includes(keyword);

      // æ‹¼éŸ³åŒ¹é…
      const namePinyinMatch = this.matchesPinyin(item.name, keyword);
      const typePinyinMatch = this.matchesPinyin(item.type, keyword);
      const eraPinyinMatch = this.matchesPinyin(item.era, keyword);

      const isMatch = nameMatch || descMatch || typeMatch || eraMatch ||
        namePinyinMatch || typePinyinMatch || eraPinyinMatch;

      // è®°å½•åŒ¹é…ç»“æœ
      if (isMatch) {
        let matchType = nameMatch ? 'åç§°åŒ¹é…' :
          descMatch ? 'æè¿°åŒ¹é…' :
            typeMatch ? 'ç±»å‹åŒ¹é…' :
              eraMatch ? 'å¹´ä»£åŒ¹é…' :
                namePinyinMatch ? 'åç§°æ‹¼éŸ³åŒ¹é…' :
                  typePinyinMatch ? 'ç±»å‹æ‹¼éŸ³åŒ¹é…' :
                    'å¹´ä»£æ‹¼éŸ³åŒ¹é…';
        console.info(`åŒ¹é…åˆ°æ–‡ç‰©: ${item.name}, åŒ¹é…ç±»å‹: ${matchType}`);
      }

      return isMatch;
    });

    console.info(`æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${this.filteredArtifacts.length} æ¡åŒ¹é…ç»“æœ`);

    // å¦‚æœè¿‡æ»¤åæ²¡æœ‰ç»“æœï¼Œæ˜¾ç¤ºæç¤º
    if (this.filteredArtifacts.length === 0) {
      this.errorMsg = `æœªæ‰¾åˆ°ä¸"${this.searchKeyword}"ç›¸å…³çš„æ–‡ç‰©`;
    } else {
      this.errorMsg = '';
    }
  }

  // è·³è½¬åˆ°æ–‡ç‰©è¯¦æƒ…é¡µé¢
  navigateToDetail(artifact: Artifact) {
    // æ‰“å°å®Œæ•´å¯¹è±¡ï¼Œç”¨äºè°ƒè¯•
    console.info(`å‡†å¤‡è·³è½¬è¯¦æƒ…ï¼ŒåŸå§‹æ–‡ç‰©å¯¹è±¡: ${JSON.stringify(artifact)}`);

    // ç¡®ä¿ä½¿ç”¨idä½œä¸ºä¸»é”®
    const id = artifact.id;

    if (id !== undefined) {
      console.info(`å‡†å¤‡è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ–‡ç‰©ID: ${id}`);

      // ä¼ é€’idå’Œå®Œæ•´å¯¹è±¡ï¼Œç¡®ä¿å‚æ•°åç§°ä¸€è‡´
      router.push({
        url: 'pages/ArtifactDetailPage',
        params: {
          id: id,
          artifactId: id, // åŒæ—¶æä¾›idå’ŒartifactIdï¼Œç¡®ä¿ä¸ä¹‹å‰ç‰ˆæœ¬å…¼å®¹
          artifact: artifact
        }
      });
      console.info(`æˆåŠŸè·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ–‡ç‰©ID: ${id}`);
    } else {
      console.error('æ–‡ç‰©IDä¸ºç©ºï¼Œæ— æ³•è·³è½¬åˆ°è¯¦æƒ…é¡µ:', JSON.stringify(artifact));
      promptAction.showToast({
        message: 'æ— æ³•æŸ¥çœ‹è¯¦æƒ…ï¼šæ–‡ç‰©IDä¸å­˜åœ¨',
        duration: 2000
      });
    }
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜
      Text($r('app.string.artifacts_title'))
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .padding({ top: 20, bottom: 16, left: 16 })
        .width('100%')
      // æ·»åŠ æœç´¢æ¡†
      Row() {
        TextInput({
          placeholder: 'è¯·è¾“å…¥å…³é”®è¯æˆ–æ‹¼éŸ³æœç´¢æ–‡ç‰©...',
          text: this.searchKeyword
        })
          .placeholderColor('#999999')
          .placeholderFont({ size: 14 })
          .backgroundColor('#F5F5F5')
          .height(40)
          .border({ radius: 20 })
          .padding({ left: 16, right: 16 })
          .layoutWeight(1)
          .type(InputType.Normal)
          .fontSize(16)
          .fontColor('#333333')
          .maxLength(50)
          .onChange((value: string) => {
            // åªæ›´æ–°æœç´¢å…³é”®è¯ï¼Œä¸æ‰§è¡Œæœç´¢
            console.info(`è¾“å…¥å˜åŒ–: "${value}"`);
            this.searchKeyword = value;
          })
        // å›¾åƒæœç´¢æŒ‰é’®
        Button({ type: ButtonType.Normal }) {
          // ä½¿ç”¨ç®€å•çš„ç›¸æœºå›¾æ ‡æ–‡æœ¬è¡¨ç¤ºï¼Œç¡®ä¿å…¼å®¹æ€§
          Text('ğŸ“·')
            .fontSize(20)
            .fontColor('#333333')
        }
        .height(40)
        .width(40)
        .margin({ left: 8 })
        .backgroundColor('#F0F0F0')
        .borderRadius(20)        .onClick(() => {
          console.info('è·³è½¬åˆ°å›¾åƒæœç´¢é¡µé¢');
          router.pushUrl({
            url: 'pages/ImageSearchPage'
          }).catch((err: Error | object) => {
            const errorMsg = err instanceof Error ? err.message : JSON.stringify(err);
            console.error(`è·³è½¬åˆ°å›¾åƒæœç´¢é¡µå¤±è´¥: ${errorMsg}`);
            promptAction.showToast({
              message: 'è·³è½¬å¤±è´¥',
              duration: 2000
            });
          });
        })

        // æœç´¢æŒ‰é’®
        Button('æœç´¢', { type: ButtonType.Normal })
          .height(40)
          .width(80)
          .margin({ left: 8 })
          .backgroundColor('#4E86FF')
          .onClick(() => {
            console.info(`ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œæœç´¢å…³é”®è¯: "${this.searchKeyword}"`);
            // åªæœ‰ç‚¹å‡»æœç´¢æŒ‰é’®æ—¶æ‰æ‰§è¡Œæœç´¢
            this.updateFilteredArtifacts();
          })
      }
      .width('100%')
      .padding({ left: 16, right: 16, bottom: 16 })

      // é”™è¯¯æç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
      if (this.errorMsg !== '') {
        Text(this.errorMsg)
          .fontSize(14)
          .fontColor('#FF0000')
          .padding(16)
          .width('100%')
      }
      Column() {
                Text('æ¬¢è¿ä½¿ç”¨æŒä¸Šåšç‰©é¦†')
                  .fontSize(16)
                  .fontColor('#666')
                  .margin({ top: 18, bottom: 4 })
                Text('å¾é›†æ–‡ç‰©è—å“è®°å½•')
                  .fontSize(22)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#888')
              }
              .width('98%')
              .height(100)
              .borderRadius(12)
              .backgroundColor('#e0e0e0')
              .backgroundImage($r('app.media.ic_collect'))
              .margin({ left: '4%', right: '4%', bottom: 16 })
              .alignItems(HorizontalAlign.Center)
              .onClick(() => {
                router.pushUrl({ url: 'pages/ProvidePage' })
              })
      // æ–‡ç‰©ç±»å‹é€‰é¡¹å¡
      Tabs({
        barPosition: BarPosition.Start,
        index: this.currentTab
      }) {
        ForEach(this.artifactTypes, (type: string, index: number) => {
          TabContent() {
            if (this.isLoading) {
              // åŠ è½½ä¸­æ˜¾ç¤º
              Column() {
                LoadingProgress()
                  .width(50)
                  .height(50)
                Text('åŠ è½½ä¸­...')
                  .fontSize(16)
                  .fontColor('#999999')
                  .margin({ top: 8 })
              }
              .height('100%')
              .width('100%')
              .justifyContent(FlexAlign.Center)
            } else if (this.filteredArtifacts.length === 0) {
              // æ— æ•°æ®æ˜¾ç¤º
              Column() {
                Text('æš‚æ— æ•°æ®')
                  .fontSize(16)
                  .fontColor('#999999')
              }
              .height('100%')
              .width('100%')
              .justifyContent(FlexAlign.Center)
            } else {
              // æ–‡ç‰©åˆ—è¡¨
              List() {
                ForEach(this.filteredArtifacts, (item: Artifact) => {
                  ListItem() {
                    Column() {
                      Row() {
                        // æ–‡ç‰©å›¾ç‰‡ï¼ˆæˆ–å ä½å›¾ï¼‰
                        Stack() {
                          if (item.imageUrl) {
                            Image(item.imageUrl)
                              .width(120)
                              .height(120)
                              .objectFit(ImageFit.Cover)
                              .borderRadius(8)
                          } else {
                            // å ä½å›¾
                            Column() {
                            }
                            .width(120)
                            .height(120)
                            .backgroundColor('#DDDDDD')
                            .borderRadius(8)
                          }
                        }
                        .margin({ right: 16 })

                        // æ–‡ç‰©ä¿¡æ¯
                        Column() {
                          Text(item.name || 'æœªå‘½åæ–‡ç‰©')
                            .fontSize(18)
                            .fontWeight(FontWeight.Medium)
                            .margin({ bottom: 8 })

                          // æœä»£å’Œç±»å‹ä¿¡æ¯ä½¿ç”¨æ›´æ¸…æ™°çš„æ ·å¼
                          Row() {
                            Text('æœä»£: ')
                              .fontSize(14)
                              .fontColor('#666666')
                            Text(item.era || 'æœªçŸ¥')
                              .fontSize(14)
                              .fontWeight(FontWeight.Medium)
                              .fontColor('#333333')
                          }
                          .margin({ bottom: 6 })
                          .width('100%')
                          Row() {
                            Text('ç±»å‹: ')
                              .fontSize(14)
                              .fontColor('#666666')
                            Text(item.type || 'æœªçŸ¥')
                              .fontSize(14)
                              .fontWeight(FontWeight.Medium)
                              .fontColor('#333333')
                          }
                          .margin({ bottom: 6 })
                          .width('100%')

                          Row() {
                            Text('åšç‰©é¦†: ')
                              .fontSize(14)
                              .fontColor('#666666')
                            Text(item.museum || 'æœªçŸ¥')
                              .fontSize(14)
                              .fontWeight(FontWeight.Medium)
                              .fontColor('#333333')
                          }
                          .margin({ bottom: 6 })
                          .width('100%')

                          // ç‚¹èµä¿¡æ¯ - ä»…æ˜¾ç¤ºç‚¹èµæ•°
                          Row() {
                            // ä½¿ç”¨æ–‡å­—ä»£æ›¿å›¾æ ‡
                            Text('ğŸ‘')
                              .fontSize(16)
                              .margin({ right: 4 })

                            Text(`${item.likes || 0}`)
                              .fontSize(14)
                              .fontColor('#666666')
                          }
                          .margin({ top: 4 })
                        }
                        .layoutWeight(1)
                        .alignItems(HorizontalAlign.Start)
                      }

                      // æ–‡ç‰©æè¿°
                      Text(item.description || 'æš‚æ— æè¿°')
                        .fontSize(14)
                        .fontColor($r('app.color.text_secondary'))
                        .margin({ top: 12 })
                        .maxLines(2)
                        .textOverflow({ overflow: TextOverflow.Ellipsis })
                    }
                    .width('100%')
                    .padding(16)
                    .borderRadius(12)
                    .backgroundColor('#FFFFFF')
                    .onClick(() => {
                      // è·³è½¬åˆ°æ–‡ç‰©è¯¦æƒ…é¡µé¢ï¼Œç¡®ä¿ä¼ é€’æ­£ç¡®å‚æ•°
                      try {
                        console.info(`å‡†å¤‡è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ–‡ç‰©ID: ${item.id}`);
                        router.pushUrl({
                          url: 'pages/ArtifactDetailPage',
                          params: {
                            artifactId: item.id,
                            id: item.id, // æ·»åŠ idå‚æ•°ï¼Œç¡®ä¿å…¼å®¹æ€§
                            artifact: item // æ·»åŠ å®Œæ•´å¯¹è±¡
                          }
                        }, (err) => {
                          if (err) {
                            console.error(`è·³è½¬åˆ°è¯¦æƒ…é¡µå¤±è´¥: ${JSON.stringify(err)}`);
                            promptAction.showToast({
                              message: `è·³è½¬å¤±è´¥: ${err.message}`,
                              duration: 2000,
                            });
                          } else {
                            console.info(`æˆåŠŸè·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ–‡ç‰©ID: ${item.id}`);
                          }
                        });
                      } catch (error) {
                        console.error(`è·³è½¬å¼‚å¸¸: ${error}`);
                        promptAction.showToast({
                          message: `è·³è½¬å¼‚å¸¸: ${error}`,
                          duration: 2000,
                        });
                      }
                    })
                  }
                  .margin({ bottom: 12 })
                })
              }
              .width('100%')
              .padding({ left: 16, right: 16 })
              .layoutWeight(1)
            }
          }
          .tabBar(type)
        })
      }
      .onChange((index) => {
        this.currentTab = index;
        this.loadArtifacts(this.artifactTypes[index]);
      })
      .height('80%') // è°ƒæ•´é«˜åº¦ä»¥é€‚åº”åº•éƒ¨å¯¼èˆªæ 
      .layoutWeight(1)
      // åº•éƒ¨å¯¼èˆªæ 
      CommonTabBar({ currentIndex: 1 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.background_color'))
  }
}
